<VirtualHost *:80>
  ServerName mycrm.interimhagn.de

  ProxyPreserveHost On

  # ACME-Challenge direkt von Apache bedienen (nicht proxien)
  ProxyPass /.well-known/acme-challenge/ !
  Alias /.well-known/acme-challenge/ /var/www/letsencrypt/.well-known/acme-challenge/
  <Directory /var/www/letsencrypt/.well-known/acme-challenge/>
    Require all granted
  </Directory>
  
  ProxyPreserveHost On
  RequestHeader set X-Forwarded-Proto "https"
  RequestHeader set X-Forwarded-SSL "on"


  # Proxy zu Gunicorn, aber Static/Media direkt ausliefern
  ProxyPass        /static/ !
  ProxyPass        /media/  !
  ProxyPass        / http://127.0.0.1:8000/
  ProxyPassReverse / http://127.0.0.1:8000/

  Alias /static/ /srv/mycrm/staticfiles/
  <Directory /srv/mycrm/staticfiles/>
    Require all granted
  </Directory>

  Alias /media/  /srv/mycrm/media/
  <Directory /srv/mycrm/media/>
    Require all granted
  </Directory>

  RequestHeader set X-Forwarded-Proto "http"
</VirtualHost>
