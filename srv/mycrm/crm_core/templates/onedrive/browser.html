{% extends "crm_core/base.html" %}
{% block content %}
<h2>OneDrive</h2>

<nav class="mb-3">
  <a href="{% url 'onedrive_browser' %}">/</a>
  {% for part, p in crumbs %}
    / <a href="{% url 'onedrive_browser' %}?path={{ p|urlencode }}">{{ part }}</a>
  {% endfor %}
</nav>

<form method="post" action="{% url 'onedrive_mkdir' %}" class="mb-3">
  {% csrf_token %}
  <input type="hidden" name="path" value="{{ path }}">
  <div class="input-group">
    <input name="name" class="form-control" placeholder="Neuer Ordnername">
    <button class="btn btn-outline-secondary" type="submit">Ordner anlegen</button>
  </div>
</form>

<form method="post" action="{% url 'onedrive_upload' %}" enctype="multipart/form-data" class="mb-4">
  {% csrf_token %}
  <input type="hidden" name="path" value="{{ path }}">
  <div class="input-group">
    <input type="file" name="file" class="form-control">
    <button class="btn btn-success" type="submit">Hochladen</button>
  </div>
</form>

<table class="table table-sm align-middle">
  <thead><tr><th>Name</th><th>Typ</th><th>Größe</th><th>Geändert</th><th></th></tr></thead>
  <tbody>
  {% for it in items %}
    <tr>
      <td>
        {% if it.folder %}
          <a href="{% url 'onedrive_browser' %}?path={{ path }}{% if path %}/{% endif %}{{ it.name|urlencode }}">{{ it.name }}</a>
        {% else %}
          {{ it.name }}
        {% endif %}
      </td>
      <td>{% if it.folder %}Ordner{% else %}Datei{% endif %}</td>
      <td>{% if it.size %}{{ it.size }}{% endif %}</td>
      <td>{{ it.lastModifiedDateTime }}</td>
      <td class="text-end">
        {% if not it.folder %}
          <a class="btn btn-sm btn-outline-primary" href="{% url 'onedrive_download' it.id %}">Download</a>
          <a class="btn btn-sm btn-outline-secondary" href="{% url 'onedrive_share' it.id %}">Freigeben</a>
        {% endif %}
        {% if it.webUrl %}
          <a class="btn btn-sm btn-outline-info" href="{{ it.webUrl }}" target="_blank">Im Web öffnen</a>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
